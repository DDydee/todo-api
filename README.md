# ToDo API

REST API для управления задачами. Реализован на **NestJS** с использованием **Prisma ORM**, **PostgreSQL** и **Redis** для кэширования. Поддерживает регистрацию, авторизацию с использованием JWT (access/refresh токены) и ролевую модель (**admin**, **user**).  

Проект создавался в процессе обучения для закрепления навыков разработки серверных приложений на NestJS.

---

## Возможности

- Регистрация и авторизация (`/sign-up`, `/sign-in`)
- Обновление токенов (`/refresh`)
- Управление пользователями (**CRUD**) — доступно только администратору (`/user`, `/user/:id`)
- Управление задачами (**CRUD**) — доступно авторизованным пользователям (`/todo`)
- Привязка тегов к задачам (**Tag**, **TodoTag**)
- Кэширование получения списка задач через **Redis** (TTL 15 минут)
- Использование ролей и статусов через **enum**

---

## Сущности

- **User** — пользователь системы  
- **Todo** — задача (title, description, user, status, deadline, createdAt, updatedAt)  
- **Tag** — тег  
- **TodoTag** — связь многие-ко-многим между задачами и тегами  
- **Role (enum)** — `USER`, `ADMIN`  
- **RefreshToken** — таблица для хранения refresh-токенов  
- **Status (enum)** — `TODO`, `IN_PROGRESS`, `DONE`  

---

## Авторизация и аутентификация

- **Access токен** используется для доступа к защищённым эндпоинтам  
- **Refresh токен** хранится в PostgreSQL и используется для обновления access токена  
- При истечении access токена клиент обращается к `/auth/refresh`, передавая пару access/refresh токенов  
- Если refresh токен валиден и совпадает с БД, сервер генерирует новую пару токенов  
- Логаут и инвалидация refresh токенов пока не реализованы  

---

## Кэширование

- Для оптимизации работы эндпоинта `/todo` используется **Redis**  
- Время жизни кэша — 15 минут  
- Инвалидация кэша пока не реализована  

---

## Документация

- Подключена **Swagger**-документация (`/api`)  
- Требует обновления (не все новые эндпоинты описаны)  

---

## Тестирование

- Unit-тесты: `user.service`  
- E2E-тесты: `user.controller`  
- Планируется расширение покрытия  

---

## Технические детали

- **NestJS** (v11) + **Prisma ORM** (v6)  
- **PostgreSQL** — основная база данных  
- **Redis** — кэширование  
- JWT (access + refresh) + Passport (jwt, local)  
- **class-validator** + **class-transformer** для валидации DTO  
- Перехватчик ошибок для унифицированного формата ответов  
- Логирование пока не реализовано  

---

## В планах

- Добавить `docker-compose` (PostgreSQL + Redis + app)  
- Обновить Swagger-документацию  
- Реализовать logout (инвалидация refresh токенов)  
- Расширить unit и e2e тестирование  
- Добавить логирование  
- Добавить фильтрацию, сортировку и пагинацию для `/todo`  
